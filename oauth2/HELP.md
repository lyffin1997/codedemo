# 1.基本概念
## 1.1什么是认证
**认证：** 用户认证是判断一个用户身份是否合法的过程
## 1.2 什么是会话
+ 在用户第一次认证成功后，为避免后续每次请求再进行认证，可将用户信息保存在会话中。
+ **会话**就是保持用户当前登录状态的机制，常见的会话有session方式或token方式
### 1.2.1 基于session
+ 传统的session+cookie方式如下图
  !img.png
+ 它的基本流程是：
    + 用户登录请求时附带用户信息发送到web服务端
    + web服务端收到信息后进行认证和授权，认证通过后会将用户信息存到session中
        + 这里有几点需要注意：
        1. session默认存储在内存中，但实际项目往往会将session存储到缓存中间件或者持久化数据库中
        2. 实际项目中用户信息存入session时是需要加密的，常用的加密算法如**md5+盐、sha256、RSA**等
    + 第一次登录请求的响应中，会在cookie中存入一个jsessionId
    + 当第一次请求登录完毕，只要不关闭浏览器或手动清楚cookie，cookie就会一直存在
        + 但是jsessionId往往是有有效期的，超过有效期浏览器中的jsessionId就无效了
    + 后续的浏览器请求会附带jsessionId，服务端会根据jsessionId找它对应的session，从而获取已经登录的用户信息
    + 这样服务端就不用再进行认证而直接响应data
### 1.2.2 基于token
+ token认证方式如下图
  ![img_1.png](img_1.png)
+ 它的基本流程是：
    + 客户端登录请求发送至服务端时进行用户认证并生成token
        + token生成方式有很多，常见的如jwt
    + 服务端将token返回至客户端，存储在浏览器cookie或localStorage中
        + **注意：** token中包含用户隐私信息，因此jwt生成token后往往会再加密一次再返回
    + 客户端后续请求中会附带token，服务端会解析并校验token
    + 校验通过后返回响应数据
### 1.2.3 区别
1. session方式信息存储在服务端，token方式信息存储在客户端
2. session方式要求客户端支持cookie，token方式一般不限制客户端存储方式
### 1.2.4 小结
现如今基本都是用token方式，原因如下：
1. 存储方式受限，现在对架构往往是分布式架构且前后端分离，以及可能会有app客户端，此时客户端不支持cookie，因此无法再用session方式
2. cookie跨域问题，cookie只会在同一域名对请求中共享，现在的分布式架构往往是多域名导向的，因此cookie不再合适
+ **虽然session方式存在以上缺点，但是也有相应的解决方案来支持session克服上述问题，但复杂且不常用，如session共享、分布式缓存、nginx负载均衡的哈希一致性算法等**
## 1.3 什么是授权
+ **授权：** 用户认证通过后，根据用户权限来控制用户访问资源的过程
## 1.4 授权数据模型
![img_3.png](img_3.png)
+ 在实际项目中，上图每一个节点代表一张数据表
## 1.5 RBAC
### 1.5.1 基于角色的访问控制
+ RBAC(Role-Based Access Control)，按角色进行授权，访问控制流程如下：
  ![img_4.png](img_4.png)
+ 基于上述流程，授权代码示例如下：
```java
if(主体.hasRole("总经理角色id")) {
    查询工资
        }
```
+ 若查询工资需要的角色为总经理和部门经理，代码逻辑变为：
```java
if(主体.hasRole("总经理角色id") || 主体.hasRole("部门经理角色id")) {
    查询工资
        }
```
+ **由此可见，修改角色权限时就需要修改授权代码，可扩展性差**
### 1.5.2 基于资源的访问控制
+ RBAC(Resource-Based Access Control)，按资源进行授权，访问控制流程如下：
  ![img_5.png](img_5.png)
+ 授权代码如下：
```java
if(主体.hasPermission("查询工资权限标识")) {
    查询工资
        }
```
+ **优点：** 在系统设计阶段，定义好资源的权限标识，即便角色变化也不需要修改授权代码，系统可扩展性强
# 2.基于session的认证方式
## 2.1 认证流程
+ 流程参考1.2.1
+ session认证是基于Servlet规范制定，用户通过HttpSession的操作方法即可实现，HttpSession的相关api如下：
  ![img_6.png](img_6.png)
+ 示例如下：
  ![img_7.png](img_7.png)
  ![img_8.png](img_8.png)
## 2.2 创建工程
+ 软件环境：
    + maven: 3.8.4
    + springboot: 2.7.17
    + jdk: 1.8
    + 编码方式：utf-8
